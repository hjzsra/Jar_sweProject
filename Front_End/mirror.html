<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>JAR — Mirror</title>
    <!-- Fonts used by the site: Playfair for headings, Roboto for body -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* ==== Base reset ==== */
        *, *::before, *::after { box-sizing: border-box; }
        html,body { height: 100%; margin: 0; }
        body {
            font-family: 'Roboto', sans-serif;
            color: #111;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            background: url('background.jpg') center/cover no-repeat fixed;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        :root{
            --card-width: min(880px, 92%);
            --card-radius: 14px;
            --muted: #6b7280;
            --accent: #0ea5a4;
            --white-90: rgba(255,255,255,0.92);
            --glass: rgba(255,255,255,0.6);
        }

        /* ==== Top navigation/menu bar ==== */
        .MenuBar{
            width: 100%;
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:12px 24px;
            /* off-white menu bar requested */
            background: #faf9f6; /* a soft off-white */
            color: #0b1720;
            position:sticky;
            top:0;
            z-index:40;
            border-bottom: 1px solid rgba(11,23,32,0.06);
        }

        .MenuBar .brand{display:flex;align-items:center;gap:12px}
    .Brand-Logo{font-family:'Playfair Display', serif;font-size:22px;letter-spacing:-0.02em;color:#0b1720}

    .MenuItems{display:flex;gap:14px;align-items:center}
    .MenuItem{color:#0b1720;padding:8px 12px;border-radius:10px;text-decoration:none;font-weight:500;opacity:0.95}
    .MenuItem:hover{background:rgba(11,23,32,0.04)}

        .SignOut{background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.06)}

        /* ==== Centered Hero/Card ==== */
        .Screen{flex:1;display:flex;align-items:center;justify-content:center;padding:36px 16px}

        .Hero-Box{
            width:var(--card-width);
            border-radius:var(--card-radius);
            background: linear-gradient(180deg, var(--white-90), var(--glass));
            box-shadow: 0 8px 30px rgba(2,6,23,0.35);
            overflow: hidden;
            display:block;
            padding:28px;
        }

        .Content-Wrapper{max-width:1200px;width:100%;margin:0 auto}

        /* Horizontal grid of boxes */
        .Grid{display:flex;gap:18px;align-items:stretch}
    /* Action row: search / prebook / set location */
    .ActionGrid{display:flex;gap:16px;margin-bottom:18px}
    .RectBox{flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.98),#ffffff);border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06);display:flex;flex-direction:column;align-items:stretch}
    .RectBox .label{font-weight:600;margin-bottom:8px;color:#0b1720}
    .RectInput{padding:10px 12px;border-radius:8px;border:1px solid #e6e6e6;margin-bottom:10px;font-size:14px}
    .RectBtn{padding:10px 12px;border-radius:8px;border:none;background:#0ea5a4;color:#fff;font-weight:600;cursor:pointer}
        .Box{flex:1;background:rgba(255,255,255,0.98);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.06);display:flex;flex-direction:column;min-height:160px}
        .Box + .Box{margin-left:0}
        .Box .box-title{font-family:'Playfair Display',serif;font-size:18px;margin:0 0 8px;color:#0b1720}
        .Box .box-body{flex:1;color:var(--muted);font-size:14px}
        .Box .box-actions{margin-top:12px;display:flex;gap:10px}
        .Button-Base{display:inline-block;padding:10px 14px;border-radius:8px;background:var(--accent);color:#fff;text-decoration:none;font-weight:600;box-shadow:0 6px 18px rgba(14,165,164,0.12);transition:transform .12s ease,box-shadow .12s ease}
        .Button-Base:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(14,165,164,0.14)}

        /* Small screens: menu collapse to icon row */
        @media (max-width:700px){
            .MenuItems{gap:8px;font-size:14px}
            .Hero-Box{padding:22px}
            .Brand-Logo{font-size:18px}
            .Grid{flex-direction:column}
            .Box{min-height:120px}
        }

        /* Input row with icon */
        .InputRow{display:flex;align-items:center;gap:8px;margin-bottom:8px}
        .input-icon{font-size:18px;opacity:0.8}
        .RectInput:focus{border-color:var(--accent);box-shadow:0 4px 12px rgba(14,165,164,0.08)}
        .RectInput:not(:placeholder-shown){background:#fbffff}
    .svg-icon{flex:0 0 20px}

    /* Search results */
    .Results{margin-top:18px;display:flex;flex-direction:column;gap:12px}
    .ResultCard{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;background:#fff;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
    .ResultInfo{display:flex;gap:12px;align-items:center}
    .ResultTitle{font-weight:700;color:#0b1720}
    .ResultMeta{color:var(--muted);font-size:13px}
    .RequestBtn{padding:8px 12px;border-radius:8px;border:none;background:#0b9fbf;color:#fff;font-weight:600;cursor:pointer}
    .RequestBtn[disabled]{opacity:0.6;cursor:not-allowed}

        /* accessibility focus states */
        a:focus{outline:3px solid rgba(14,165,164,0.18);outline-offset:2px}

    </style>
</head>
<body>

    <header class="MenuBar" role="navigation" aria-label="Main menu">
        <div class="brand">
            <div style="width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700">J</div>
            <div class="Brand-Logo">JAR</div>
        </div>

        <nav class="MenuItems" aria-label="User menu">
            <a class="MenuItem" href="profileInfo.html">Profile</a>
            <a class="MenuItem" href="#">Wallet</a>
            <a class="MenuItem" href="#">Trips</a>
            <a class="MenuItem" href="#">Settings</a>
            <a class="MenuItem SignOut" href="login.html">Log out</a>
        </nav>
    </header>

    <main class="Screen" role="main">
        <section class="Hero-Box" role="region" aria-label="Mirror page">
            <div class="Content-Wrapper">
                <!-- removed main dashboard text per request; show horizontal boxes -->
                <div class="ActionGrid" role="region" aria-label="Quick actions">
                    <div class="RectBox" role="region" aria-label="Search nearby ride">
                        <div class="label">Search nearby ride</div>
                        <div class="InputRow">
                            <svg class="svg-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z" fill="#0B1720"/>
                            </svg>
                            <input class="RectInput" id="searchFrom" placeholder="From (your location)" aria-label="From location" />
                        </div>
                        <div class="InputRow">
                            <svg class="svg-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z" fill="#0B1720"/>
                            </svg>
                            <input class="RectInput" id="searchTo" placeholder="To (destination)" aria-label="To destination" />
                        </div>
                        <div style="display:flex;gap:8px;align-items:center">
                            <button id="searchBtn" class="RectBtn" type="button">Search</button>
                            <div id="searchMessage" role="status" aria-live="polite" style="font-size:13px;color:var(--muted)"></div>
                        </div>
                    </div>

                    <div class="RectBox" role="region" aria-label="Pre-book shared ride">
                        <div class="label">Pre-book your shared ride</div>
                        <div class="InputRow">
                            <svg class="svg-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7 10h5v5H7v-5z" fill="#0B1720"/>
                            </svg>
                            <input class="RectInput" id="prebookDate" type="date" aria-label="Prebook date" />
                        </div>
                        <div class="InputRow">
                            <svg class="svg-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M12 1a11 11 0 1 0 11 11A11 11 0 0 0 12 1zm1 12.59V7h-2v6h6v-2z" fill="#0B1720"/>
                            </svg>
                            <input class="RectInput" id="prebookTime" type="time" aria-label="Prebook time" />
                        </div>
                        <div style="display:flex;gap:8px;align-items:center">
                            <button id="prebookBtn" class="RectBtn" type="button">Pre-book</button>
                            <div id="prebookMessage" role="status" aria-live="polite" style="font-size:13px;color:var(--muted)"></div>
                        </div>
                    </div>

                    <div class="RectBox" role="region" aria-label="Set your location">
                        <div class="label">Set your location</div>
                        <div class="InputRow">
                            <svg class="svg-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7zm0 9.5A2.5 2.5 0 1 1 12 6a2.5 2.5 0 0 1 0 5.5z" fill="#0B1720"/>
                            </svg>
                            <input class="RectInput" id="locationInput" placeholder="Enter your location or use GPS" aria-label="Location input" />
                        </div>
                        <div style="display:flex;gap:8px;align-items:center">
                            <button id="setLocationBtn" class="RectBtn" type="button">Set Location</button>
                            <div id="locationMessage" role="status" aria-live="polite" style="font-size:13px;color:var(--muted)"></div>
                        </div>
                    </div>
                </div>

                <div class="Grid" role="list">
                    <article class="Box" role="listitem" aria-label="Profile box">
                        <h3 class="box-title">Profile</h3>
                        <div class="box-body">View and edit your personal information, university details and verification status.</div>
                        <div class="box-actions">
                            <a class="Button-Base" href="profileInfo.html">Open Profile</a>
                        </div>
                    </article>

                    <article class="Box" role="listitem" aria-label="Trips box">
                        <h3 class="box-title">Trips</h3>
                        <div class="box-body">See active and past ride requests, upcoming rides and shared trips with classmates.</div>
                        <div class="box-actions">
                            <a class="Button-Base" href="tripDetails.html">My Trips</a>
                        </div>
                    </article>

                    <article class="Box" role="listitem" aria-label="Wallet box">
                        <h3 class="box-title">Wallet</h3>
                        <div class="box-body">Manage payment methods, view balances and recent transactions.</div>
                        <div class="box-actions">
                            <a class="Button-Base" href="paymentMethods1.html">Open Wallet</a>
                        </div>
                    </article>

                    <article class="Box" role="listitem" aria-label="Settings box">
                        <h3 class="box-title">Settings</h3>
                        <div class="box-body">Adjust app preferences, notifications and privacy settings.</div>
                        <div class="box-actions">
                            <a class="Button-Base" href="#">Open Settings</a>
                        </div>
                    </article>
                </div>
                <!-- Search results will be injected here -->
                <div id="results" class="Results" aria-live="polite"></div>
            </div>
        </section>
    </main>

</body>
</html>
<script>
    function setLocation(){
        const val = document.getElementById('locationInput').value.trim();
        if(!val){
            // try geolocation
            if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(pos=>{
                    alert('Location set: ' + pos.coords.latitude + ',' + pos.coords.longitude);
                }, err=>{alert('Unable to get location: ' + err.message)});
            } else alert('Enter a location or enable GPS');
            return;
        }
        alert('Location set to: ' + val);
    }
</script>
<script>
    // Utility: show message in an element briefly
    function showMessage(el, text, isError){
        el.textContent = text;
        el.style.color = isError ? '#b91c1c' : 'var(--muted)';
        setTimeout(()=>{ el.textContent = ''; }, 5000);
    }

    async function searchNearby(){
        const from = document.getElementById('searchFrom').value.trim();
        const to = document.getElementById('searchTo').value.trim();
        const msg = document.getElementById('searchMessage');
        if(!from || !to){ showMessage(msg, 'Please enter both origin and destination', true); return; }

        const btn = document.getElementById('searchBtn');
        btn.disabled = true; btn.textContent = 'Searching...';
        try{
            // Example API call - adjust endpoint to your backend
            const res = await fetch('/api/search/nearby/', {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({from, to})
            });
            if(!res.ok){ throw new Error('Search failed'); }
            const data = await res.json();
            const results = data.results || [];
            showMessage(msg, 'Found ' + (results.length||0) + ' rides');
            renderResults(results);
        }catch(err){
            console.error(err); showMessage(msg, 'Search error: ' + err.message, true);
        }finally{ btn.disabled=false; btn.textContent='Search'; }
    }

    function renderResults(results){
        const container = document.getElementById('results');
        container.innerHTML = '';
        if(!results || results.length===0){
            const none = document.createElement('div');
            none.className = 'ResultCard';
            none.textContent = 'No rides found for your query.';
            container.appendChild(none);
            return;
        }

        results.forEach(r => {
            // expected r: { id, title, eta, seats, price }
            const card = document.createElement('div');
            card.className = 'ResultCard';

            const info = document.createElement('div');
            info.className = 'ResultInfo';

            const title = document.createElement('div');
            title.className = 'ResultTitle';
            title.textContent = r.title || ('Ride ' + (r.id || ''));

            const meta = document.createElement('div');
            meta.className = 'ResultMeta';
            meta.textContent = `${r.eta ? 'ETA: '+r.eta+' • ' : ''}${r.seats ? r.seats+' seats • ' : ''}${r.price ? r.price+' SAR' : ''}`;

            info.appendChild(title);
            info.appendChild(meta);

            const actions = document.createElement('div');
            const btn = document.createElement('button');
            btn.className = 'RequestBtn';
            btn.textContent = 'Request';
            btn.type = 'button';
            btn.onclick = ()=> requestRide(r.id, btn, card);

            actions.appendChild(btn);
            card.appendChild(info);
            card.appendChild(actions);
            container.appendChild(card);
        });
    }

    async function requestRide(rideId, btn, card){
        if(!rideId){ alert('Missing ride id'); return; }
        const origText = btn.textContent;
        btn.disabled = true; btn.textContent = 'Requesting...';
        try{
            const res = await fetch('/api/trips/request/', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ride_id: rideId})});
            if(!res.ok){ const txt = await res.text(); throw new Error(txt || 'Request failed'); }
            const data = await res.json();
            // show inline success message inside the card
            const info = card.querySelector('.ResultInfo');
            const ok = document.createElement('div');
            ok.className = 'ResultMeta';
            ok.style.color = '#059669';
            ok.textContent = 'Request sent ✓';
            info.appendChild(ok);
            btn.disabled = true; btn.textContent = 'Requested';
        }catch(err){
            console.error(err);
            alert('Request failed: ' + err.message);
            btn.disabled = false; btn.textContent = origText;
        }
    }

    async function prebookRide(){
        const date = document.getElementById('prebookDate').value;
        const time = document.getElementById('prebookTime').value;
        const msg = document.getElementById('prebookMessage');
        if(!date || !time){ showMessage(msg, 'Please select both date and time for your pre-booking.', true); return; }

        // Validate date/time not in the past
        const selected = new Date(date + 'T' + time);
        const now = new Date();
        if(selected.getTime() <= now.getTime()){ showMessage(msg, 'Selected date/time is in the past. Choose a future time.', true); return; }

        const btn = document.getElementById('prebookBtn');
        btn.disabled = true; btn.textContent = 'Booking...';
        try{
            const res = await fetch('/api/trips/prebook/', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({date,time})});
            if(!res.ok){ const txt = await res.text(); throw new Error(txt||'Pre-book failed'); }
            const d = await res.json();
            showMessage(msg, 'Pre-book successful');
        }catch(err){ console.error(err); showMessage(msg, 'Error: '+err.message, true); }
        finally{ btn.disabled=false; btn.textContent='Pre-book'; }
    }

    document.getElementById('searchBtn').addEventListener('click', searchNearby);
    document.getElementById('prebookBtn').addEventListener('click', prebookRide);
    document.getElementById('setLocationBtn').addEventListener('click', setLocation);
</script>
